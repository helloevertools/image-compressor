<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Compress images online for free with our fast, privacy-focused tool. Reduce JPG, PNG, WebP file sizes by 80% without losing quality. No registration needed!">
    <meta name="keywords" content="image compressor, compress images, reduce image size, online image optimizer, JPG compressor, PNG compressor, WebP compressor, free photo compressor, image size reducer, picture compressor">
    <meta name="author" content="Image Compressor Tool">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Free Online Image Compressor - Reduce Photo Size Instantly">
    <meta property="og:description" content="Compress JPG, PNG, WebP images online for free. Reduce file size by up to 80% without quality loss. No registration needed!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourusername.github.io/image-compressor">
    <meta property="og:image" content="https://yourusername.github.io/image-compressor/thumbnail.jpg">
    
    <title>Free Image Compressor Online - Reduce JPG, PNG, WebP Size [2024]</title>
    
    <link rel="canonical" href="https://yourusername.github.io/image-compressor">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_ADSENSE_ID" crossorigin="anonymous"></script>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Free Online Image Compressor",
      "url": "https://yourusername.github.io/image-compressor",
      "description": "Compress JPG, PNG, WebP images online for free. Reduce file size by up to 80% without quality loss.",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "Image Compressor Tool"
      }
    }
    </script>
    
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
            --medium-gray: #757575;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background-color: #f9f9f9;
            padding: 0;
            margin: 0;
        }
        
        header {
            background-color: white;
            box-shadow: var(--shadow);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .logo span {
            color: var(--accent-color);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            text-decoration: none;
            color: var(--dark-gray);
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: var(--primary-color);
        }
        
        main {
            padding: 2rem 0;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .hero p {
            font-size: 1.1rem;
            color: var(--medium-gray);
            max-width: 800px;
            margin: 0 auto 1.5rem;
        }
        
        .compressor-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .upload-area {
            border: 2px dashed var(--medium-gray);
            border-radius: var(--border-radius);
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(66, 133, 244, 0.05);
        }
        
        .upload-area.active {
            border-color: var(--secondary-color);
            background-color: rgba(52, 168, 83, 0.05);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .control-group {
            flex: 1;
            min-width: 250px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: var(--light-gray);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 500;
        }
        
        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            background-color: white;
        }
        
        .buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3367d6;
        }
        
        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .results {
            display: none;
            margin-top: 2rem;
            border-top: 1px solid var(--light-gray);
            padding-top: 2rem;
        }
        
        .comparison {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .image-box {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        
        .image-box img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }
        
        .image-info {
            background-color: var(--light-gray);
            padding: 1rem;
            border-radius: var(--border-radius);
        }
        
        .download-btn {
            display: inline-block;
            margin-top: 1rem;
            text-decoration: none;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--medium-gray);
        }
        
        .ad-container {
            margin: 2rem 0;
            text-align: center;
            background-color: var(--light-gray);
            padding: 1rem;
            border-radius: var(--border-radius);
        }
        
        .ad-label {
            font-size: 0.8rem;
            color: var(--medium-gray);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .feature-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            margin-bottom: 1rem;
            color: var(--dark-gray);
        }
        
        .feature-card p {
            color: var(--medium-gray);
        }
        
        footer {
            background-color: var(--dark-gray);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--primary-color);
        }
        
        .copyright {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            nav ul li {
                margin: 0 0.75rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .comparison {
                flex-direction: column;
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 2rem auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* Focus styles for better keyboard navigation */
        a:focus, button:focus, input:focus, select:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="#" class="logo">Image<span>Compressor</span></a>
            <nav>
                <ul>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#faq">FAQ</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <main class="container">
        <!-- Top Ad Banner -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your AdSense code -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_ADSENSE_ID"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <section class="hero">
            <h1>Free Online Image Compressor - Reduce Photo Size Instantly</h1>
            <p>Reduce image file size by up to 80% without losing quality. Perfect for websites, social media, and email attachments. Supports JPG, PNG, and WebP formats. No registration required!</p>
        </section>
        
        <section class="compressor-container">
            <div id="upload-area" class="upload-area">
                <div class="upload-icon">📁</div>
                <h2>Drag & Drop Your Images Here</h2>
                <p>or click to browse files (Supports JPG, PNG, WebP)</p>
                <input type="file" id="file-input" accept="image/*" multiple style="display: none;">
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="quality">Compression Level</label>
                    <div class="slider-container">
                        <input type="range" id="quality" class="slider" min="0" max="100" value="80">
                        <span id="quality-value" class="slider-value">80%</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="format">Output Format</label>
                    <select id="format">
                        <option value="auto">Auto (Recommended)</option>
                        <option value="jpeg">JPEG (Best for photos)</option>
                        <option value="png">PNG (Best for transparency)</option>
                        <option value="webp">WebP (Best quality/size ratio)</option>
                    </select>
                </div>
            </div>
            
            <div class="buttons">
                <button id="compress-btn" class="btn btn-primary">Compress Images</button>
                <button id="reset-btn" class="btn btn-secondary">Reset</button>
            </div>
            
            <div id="spinner" class="spinner"></div>
            
            <div id="results" class="results">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="original-size">0 KB</div>
                        <div class="stat-label">Original Size</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="compressed-size">0 KB</div>
                        <div class="stat-label">Compressed Size</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="savings">0%</div>
                        <div class="stat-label">Savings</div>
                    </div>
                </div>
                
                <div class="comparison">
                    <div class="image-box">
                        <h3>Original Image</h3>
                        <img id="original-img" src="" alt="Original image before compression">
                        <div class="image-info">
                            <p id="original-info">Dimensions: 0×0 | Size: 0 KB</p>
                        </div>
                    </div>
                    <div class="image-box">
                        <h3>Compressed Image</h3>
                        <img id="compressed-img" src="" alt="Compressed image after optimization">
                        <div class="image-info">
                            <p id="compressed-info">Dimensions: 0×0 | Size: 0 KB</p>
                            <a id="download-btn" href="#" class="btn btn-primary download-btn">Download</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Middle Ad Banner -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your AdSense code -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_ADSENSE_ID"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <section id="features" class="features">
            <div class="feature-card">
                <div class="feature-icon">⚡</div>
                <h3>Lightning Fast</h3>
                <p>Process images in seconds with our optimized compression algorithms. No waiting for server processing.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔒</div>
                <h3>100% Private</h3>
                <p>Your images never leave your device. All processing happens in your browser for maximum privacy.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💯</div>
                <h3>High Quality</h3>
                <p>Smart compression maintains visual quality while significantly reducing file size.</p>
            </div>
        </section>
        
        <section id="how-it-works" class="compressor-container" style="margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1.5rem; text-align: center;">How Our Image Compressor Works</h2>
            <div style="max-width: 800px; margin: 0 auto;">
                <p style="margin-bottom: 1rem;">Our free online image compression tool makes it easy to reduce file sizes while maintaining quality. Perfect for bloggers, webmasters, and social media users who need fast, efficient image optimization.</p>
                <ol style="padding-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li style="margin-bottom: 0.5rem;"><strong>Upload your image</strong> - Simply drag and drop or click to select files from your device. We support JPG, PNG, and WebP formats.</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Adjust settings</strong> - Choose your preferred compression level (80% is recommended for most cases) and output format.</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Compress with one click</strong> - Our advanced algorithms process your image instantly in your browser.</li>
                    <li><strong>Download the optimized image</strong> - Save space and bandwidth with your newly compressed file.</li>
                </ol>
                <p>Unlike other tools, we never upload your images to any server. Everything happens locally in your browser for maximum privacy and security.</p>
            </div>
        </section>
        
        <!-- Bottom Ad Banner -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your AdSense code -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_ADSENSE_ID"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <section id="faq" class="compressor-container" style="margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1.5rem; text-align: center;">Frequently Asked Questions</h2>
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 0.5rem;">Is this image compressor really free?</h3>
                    <p style="color: var(--medium-gray);">Yes! Our online image compression tool is completely free to use with no hidden charges, watermarks, or registration required.</p>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 0.5rem;">How does this maintain privacy better than other tools?</h3>
                    <p style="color: var(--medium-gray);">Unlike many online compressors, we never upload your images to any server. All processing happens directly in your browser using JavaScript, so your files stay completely private.</p>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 0.5rem;">What's the maximum image size I can compress?</h3>
                    <p style="color: var(--medium-gray);">The tool can handle most standard images, but very large files (over 20MB) might cause performance issues on some devices. For best results, we recommend compressing images under 10MB.</p>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 0.5rem;">Which format gives the best compression?</h3>
                    <p style="color: var(--medium-gray);">WebP generally offers the best compression with good quality. Our "Auto" setting will analyze your image and choose the optimal format (JPEG for photos, PNG for graphics with transparency, WebP for best quality/size ratio).</p>
                </div>
                <div>
                    <h3 style="margin-bottom: 0.5rem;">Can I compress multiple images at once?</h3>
                    <p style="color: var(--medium-gray);">Yes! Simply select multiple files when uploading, and our tool will process them one by one. This is perfect for optimizing entire folders of images for your website.</p>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#">Home</a>
                <a href="#features">Features</a>
                <a href="#how-it-works">How It Works</a>
                <a href="#faq">FAQ</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Contact</a>
            </div>
            <p class="copyright">© <span id="year"></span> ImageCompressor Tool. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // Set current year in footer
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // DOM elements
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const qualitySlider = document.getElementById('quality');
        const qualityValue = document.getElementById('quality-value');
        const formatSelect = document.getElementById('format');
        const compressBtn = document.getElementById('compress-btn');
        const resetBtn = document.getElementById('reset-btn');
        const spinner = document.getElementById('spinner');
        const resultsSection = document.getElementById('results');
        const originalImg = document.getElementById('original-img');
        const compressedImg = document.getElementById('compressed-img');
        const originalInfo = document.getElementById('original-info');
        const compressedInfo = document.getElementById('compressed-info');
        const originalSize = document.getElementById('original-size');
        const compressedSize = document.getElementById('compressed-size');
        const savings = document.getElementById('savings');
        const downloadBtn = document.getElementById('download-btn');
        
        // Variables to store file data
        let currentFile = null;
        let originalFileSize = 0;
        let compressedFileSize = 0;
        
        // Update quality value display
        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = `${qualitySlider.value}%`;
        });
        
        // Handle drag and drop events
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('active');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('active');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('active');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelection();
            }
        });
        
        // Handle click on upload area
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // Handle file selection
        fileInput.addEventListener('change', handleFileSelection);
        
        function handleFileSelection() {
            if (fileInput.files && fileInput.files[0]) {
                currentFile = fileInput.files[0];
                originalFileSize = currentFile.size;
                
                // Display original image
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImg.src = e.target.result;
                    
                    // Get image dimensions
                    const img = new Image();
                    img.onload = function() {
                        originalInfo.textContent = `Dimensions: ${this.width}×${this.height} | ${formatFileSize(originalFileSize)}`;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(currentFile);
                
                // Enable compress button
                compressBtn.disabled = false;
                
                // Track file upload (for analytics if you add them)
                console.log('File selected:', currentFile.name, formatFileSize(originalFileSize));
            }
        }
        
        // Handle compress button click
        compressBtn.addEventListener('click', compressImage);
        
        async function compressImage() {
            if (!currentFile) return;
            
            // Show loading spinner
            spinner.style.display = 'block';
            compressBtn.disabled = true;
            resultsSection.style.display = 'none';
            
            // Get selected quality (convert from 0-100 to 0-1 for some formats)
            const quality = qualitySlider.value / 100;
            const format = formatSelect.value;
            
            try {
                // Create a canvas to draw the compressed image
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Load the original image
                const img = await loadImage(URL.createObjectURL(currentFile));
                
                // Set canvas dimensions
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw image on canvas
                ctx.drawImage(img, 0, 0);
                
                // Determine output format
                let outputFormat = format;
                if (format === 'auto') {
                    // Simple heuristic for format selection
                    if (currentFile.type === 'image/png' && hasTransparency(img)) {
                        outputFormat = 'png';
                    } else {
                        outputFormat = 'webp'; // Default to WebP for best compression
                    }
                }
                
                // Convert to data URL with specified format and quality
                let compressedDataUrl;
                if (outputFormat === 'jpeg' || outputFormat === 'jpg') {
                    compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                } else if (outputFormat === 'png') {
                    compressedDataUrl = canvas.toDataURL('image/png');
                } else {
                    compressedDataUrl = canvas.toDataURL('image/webp', quality);
                }
                
                // Convert data URL to Blob
                const compressedBlob = dataUrlToBlob(compressedDataUrl);
                compressedFileSize = compressedBlob.size;
                
                // Display compressed image
                compressedImg.src = compressedDataUrl;
                compressedInfo.textContent = `Dimensions: ${img.width}×${img.height} | ${formatFileSize(compressedFileSize)}`;
                
                // Update stats
                originalSize.textContent = formatFileSize(originalFileSize);
                compressedSize.textContent = formatFileSize(compressedFileSize);
                
                const savingPercent = Math.round(((originalFileSize - compressedFileSize) / originalFileSize) * 100);
                savings.textContent = `${savingPercent}%`;
                
                // Set up download link
                const compressedFile = new File([compressedBlob], getOutputFilename(currentFile.name, outputFormat), {
                    type: compressedBlob.type
                });
                
                downloadBtn.href = URL.createObjectURL(compressedFile);
                downloadBtn.download = compressedFile.name;
                
                // Show results
                resultsSection.style.display = 'block';
                
                // Track successful compression (for analytics if you add them)
                console.log('Compression successful:', 
                    `Original: ${formatFileSize(originalFileSize)}`, 
                    `Compressed: ${formatFileSize(compressedFileSize)}`, 
                    `Savings: ${savingPercent}%`);
                
            } catch (error) {
                console.error('Compression error:', error);
                alert('An error occurred during compression. Please try again with a different image or settings.');
            } finally {
                // Hide spinner
                spinner.style.display = 'none';
                compressBtn.disabled = false;
            }
        }
        
        // Helper function to generate output filename
        function getOutputFilename(originalName, format) {
            const nameWithoutExt = originalName.lastIndexOf('.') > 0 
                ? originalName.substring(0, originalName.lastIndexOf('.')) 
                : originalName;
            
            let extension;
            switch(format) {
                case 'jpeg':
                case 'jpg':
                    extension = 'jpg';
                    break;
                case 'png':
                    extension = 'png';
                    break;
                case 'webp':
                    extension = 'webp';
                    break;
                default:
                    extension = 'webp';
            }
            
            return `compressed_${nameWithoutExt}.${extension}`;
        }
        
        // Helper function to load an image
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }
        
        // Helper function to check for transparency in an image
        function hasTransparency(img) {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, 1, 1);
            const pixelData = ctx.getImageData(0, 0, 1, 1).data;
            return pixelData[3] < 255; // Check alpha channel
        }
        
        // Helper function to convert data URL to Blob
        function dataUrlToBlob(dataUrl) {
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            
            return new Blob([u8arr], { type: mime });
        }
        
        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Handle reset button click
        resetBtn.addEventListener('click', resetTool);
        
        function resetTool() {
            fileInput.value = '';
            currentFile = null;
            originalImg.src = '';
            compressedImg.src = '';
            originalInfo.textContent = 'Dimensions: 0×0 | Size: 0 KB';
            compressedInfo.textContent = 'Dimensions: 0×0 | Size: 0 KB';
            originalSize.textContent = '0 KB';
            compressedSize.textContent = '0 KB';
            savings.textContent = '0%';
            resultsSection.style.display = 'none';
            compressBtn.disabled = true;
            qualitySlider.value = 80;
            qualityValue.textContent = '80%';
            formatSelect.value = 'auto';
        }
        
        // Initialize tool
        resetTool();
    </script>
</body>
</html>
